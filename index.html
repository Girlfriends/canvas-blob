<!DOCTYPE html>
<html>
<head>
	<title>Canvas Play</title>
	<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.11.4/paper-core.min.js"></script>
</head>
<body>
<canvas id="canvas" width="800px" height="600px"></canvas>
<script type="text/javascript">
	// Only executed our code once the DOM is ready.
	window.onload = function() {

		// Get a reference to the canvas object
		var canvas = document.getElementById('canvas');
		// Create an empty project and a view for the canvas:
		paper.setup(canvas);

		var rootSpeed = 0.01;
		var speedOffset = 0;
		var radius = 175;
		var width, height, center;
		var points = 10;
		var smooth = true;
		var path = new paper.Path();
		var mousePos = {
			x: paper.view.center.x,
			y: paper.view.center.y
		};
		var pathHeight = mousePos.y;
		var tool = new paper.Tool();
		path.fillColor = 'black';
		initializePath();

		function initializePath() {
			center = paper.view.center;
			width = paper.view.size.width;
			height = paper.view.size.height / 2;
			path.segments = [];

			for (var i=0; i<points; i++) {
				var angle = Math.PI * 2 * (i/points);
				var x = center.x + Math.cos(angle) * radius;
				var y = center.y + Math.sin(angle) * radius;
				var point = new paper.Point(x, y);
				path.add(point);
			}

			path.closed = true;
			path.fullySelected = false;
		}

		paper.view.onFrame = function(event) {
			var speed = (rootSpeed + speedOffset);
			speedOffset *= 0.99;
			pathHeight += (center.y - mousePos.y - pathHeight) / 10;

			for (var i = 0; i < points; i++) {
				var sinSeed = event.count + (i + i % 10) * 100;
				var sinHeight = Math.sin(sinSeed * speed / 2) * pathHeight;
				var delta = Math.sin(sinSeed * speed) * sinHeight;

				var angle = Math.PI * 2 * (i/points);
				var x = center.x + Math.cos(angle) * (radius + delta);
				var y = center.y + Math.sin(angle) * (radius + delta);

				path.segments[i].point.x = x;
				path.segments[i].point.y = y;
			}
			if (smooth)
				path.smooth({ type: 'continuous' });
		}

		tool.onMouseMove = function(event) {
			mousePos = event.point;
		}

		tool.onMouseDown = function(event) {
			// smooth = !smooth;
			// if (!smooth) {
			// 	// If smooth has been turned off, we need to reset
			// 	// the handles of the path:
			// 	for (var i = 0, l = path.segments.length; i < l; i++) {
			// 		var segment = path.segments[i];
			// 		segment.handleIn = segment.handleOut = null;
			// 	}
			// }

			speedOffset = 0.02;
		}

		// Reposition the path whenever the window is resized:
		function onResize(event) {
			initializePath();
		}
	}
</script>
</body>
</html>